<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="đọc truyện tranh, manga online, manhwa miễn phí, manhua mới nhất, truyện hay, TruyenYeu">
    <meta name="description" content="TruyenYeu - Đọc truyện tranh miễn phí, cập nhật manga, manhwa, manhua mới nhất mỗi ngày. Khám phá kho truyện đa dạng, chất lượng cao!">
    <meta property="og:title" content="TruyenYeu - Đọc Truyện Tranh Miễn Phí Online">
    <meta property="og:description" content="Đọc truyện tranh miễn phí tại TruyenYeu. Cập nhật manga, manhwa, manhua mới nhất mỗi ngày. Khám phá ngay!">
    <meta property="og:image" content="https://i.ibb.co/sB5C6hQ/logo.png">
    <meta property="og:url" content="https://truyen0hay.site">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="TruyenYeu - Đọc Truyện Tranh Miễn Phí Online">
    <meta name="twitter:description" content="Đọc truyện tranh miễn phí tại TruyenYeu. Cập nhật manga, manhwa, manhua mới nhất mỗi ngày.">
    <meta name="twitter:image" content="https://i.ibb.co/sB5C6hQ/logo.png">
    <meta name="robots" content="index, follow">
    <meta name="author" content="TruyenYeu">
    <meta name="revisit-after" content="1 days">
    <meta name="google-adsense-account" content="ca-pub-7781390490354736">
    <link href="https://i.ibb.co/sB5C6hQ/logo.png" rel="icon" type="image/png">
    <title>Trang Chủ - TruyenYeu - Đọc Truyện Tranh Miễn Phí Online</title>
    <link rel="preload" href="https://i.ibb.co/sB5C6hQ/logo.png" as="image">
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "TruyenYeu",
        "url": "https://truyen0hay.site",
        "description": "Đọc truyện tranh miễn phí tại TruyenYeu. Cập nhật manga, manhwa, manhua mới nhất mỗi ngày.",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://truyen0hay.site/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <style>
        .update-tag { background-color: #00b7eb; color: #ffffff; font-size: 12px; font-weight: bold; padding: 2px 6px; border-radius: 3px; }
        .badge-18plus { position: absolute; top: 8px; right: 8px; background-color: #ff0000; color: #ffffff; font-size: 12px; font-weight: bold; padding: 2px 6px; border-radius: 3px; z-index: 10; }
        .time-tag { position: absolute; top: 8px; left: 8px; background-color: #0099FF; color: #ffffff; font-size: 12px; font-weight: bold; padding: 2px 6px; border-radius: 3px; z-index: 10; }
        .horizontal-slider { overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none; -ms-overflow-style: none; }
        .horizontal-slider::-webkit-scrollbar { display: none; }
        .slide-item { scroll-snap-align: start; flex-shrink: 0; }
        .tab-button { padding: 8px 16px; cursor: pointer; transition: all 0.3s; }
        .tab-button.active { background-color: #10b981; color: white; }
    </style>
</head>
<body class="bg-gray-900 text-white font-poppins">
    <?php include 'includes/header.php'; ?>

    <!-- Phần trên với carousel và sidebar -->
    <div class="container mx-auto px-4 py-8 flex flex-col lg:flex-row gap-8 pt-16">
        <div class="lg:w-3/4">
            <!-- Carousel -->
            <div 
                x-data="{ 
                    currentSlide: 0,
                    init() {
                        this.startAutoSlide();
                    },
                    startAutoSlide() {
                        setInterval(() => {
                            this.currentSlide = (this.currentSlide + 1) % <?= count($stories) ?>;
                        }, 5000);
                    }
                }" 
                class="relative mb-8"
            >
                <div class="overflow-hidden rounded-lg">
                    <div class="flex transition-transform duration-500" :style="'transform: translateX(-' + (currentSlide * 100) + '%)'">
                        <?php 
                        $imagePaths = [
                            'img/slide/image1.jpg',
                            'img/slide/image2.jpg',
                            'img/slide/image3.jpg',
                            'img/slide/image4.jpg'
                        ];
                        foreach ($stories as $i => $story):
                            if ($i >= count($storySlugs)) break;
                        ?>
                            <div class="min-w-full relative">
                                <img 
                                    src="<?= $imagePaths[$i] ?>" 
                                    alt="<?= htmlspecialchars($story['name']) ?>" 
                                    class="w-full h-auto object-cover rounded-lg" 
                                    style="aspect-ratio: 16/9; max-height: 500px;"
                                >
                                <div class="absolute inset-x-0 bottom-0 h-2/3 bg-gradient-to-t from-black to-transparent flex items-end p-6">
                                    <div class="flex flex-col items-start md:items-start w-full">
                                        <h2 class="text-xl md:text-2xl font-bold text-white text-center md:text-left w-full"><?= htmlspecialchars($story['name']) ?></h2>
                                        <a 
                                            href="views/truyen-tranh/<?= urlencode($story['slug']) ?>" 
                                            class="mt-2 inline-block bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors duration-300 self-center md:self-start"
                                        >
                                            Đọc ngay
                                        </a>
                                    </div>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                </div>
                <button 
                    @click="currentSlide = (currentSlide - 1 + <?= count($stories) ?>) % <?= count($stories) ?>" 
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-gray-800 p-2 rounded-full hover:bg-gray-700 transition-colors duration-300"
                >
                    <i class="fas fa-chevron-left text-white"></i>
                </button>
                <button 
                    @click="currentSlide = (currentSlide + 1) % <?= count($stories) ?>" 
                    class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-gray-800 p-2 rounded-full hover:bg-gray-700 transition-colors duration-300"
                >
                    <i class="fas fa-chevron-right text-white"></i>
                </button>
            </div>

            <!-- Truyện mới cập nhật -->
            <h4 class="text-2xl font-semibold mb-6 text-center">TRUYỆN TRANH MỚI CẬP NHẬT</h4>
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 mb-8" x-data="{ visible: false }" x-init="$nextTick(() => visible = true)" :class="visible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10'" x-transition.duration.500ms>
                <?php foreach ($truyenList as $truyen): ?>
                    <div class="bg-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                        <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="relative block">
                            <img src="https://img.otruyenapi.com/uploads/comics/<?= htmlspecialchars($truyen['thumb_url']) ?>" 
                                 class="w-full object-cover" 
                                 alt="<?= htmlspecialchars($truyen['name']) ?>" 
                                 loading="lazy" 
                                 style="aspect-ratio: 3/4; height: 220px;">
                            <?php 
                            foreach ($truyen['category'] ?? [] as $cat) {
                                if (in_array($cat['name'], ['Adult', '16+', 'Ecchi', 'Smut'])) {
                                    echo '<span class="badge-18plus">18+</span>';
                                    break;
                                }
                            }
                            ?>
                            <span class="time-tag"><?= timeAgo($truyen['updatedAt'] ?? null) ?></span>
                        </a>
                        <div class="p-2">
                            <h5 class="text-base font-semibold truncate text-white mb-1 text-center">
                                <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="hover:text-green-500"><?= htmlspecialchars($truyen['name']) ?></a>
                            </h5>
                            <div class="flex justify-between items-center text-base text-gray-300 mb-1">
                                <span><i class="fas fa-bookmark mr-1 text-green-500"></i> <?= htmlspecialchars($truyen['chaptersLatest'][0]['chapter_name'] ?? 'Chưa có') ?></span>
                                <span><i class="fas fa-eye mr-1 text-yellow-400"></i> <?= formatViews($truyen['views']) ?></span>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
                <div class="bg-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 flex items-center justify-center">
                    <a href="views/dang-phat-hanh" class="flex flex-col items-center justify-center h-full text-center p-4">
                        <i class="fas fa-arrow-right text-3xl text-green-500 mb-2"></i>
                        <span class="text-base font-semibold text-white">Xem thêm</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Sidebar (chỉ ở khu vực trên) -->
        <div class="lg:w-1/4">
            <!-- Bảng Xếp Hạng -->
            <div class="bg-gray-800 p-4 rounded-lg mb-6" x-data="{ activeTab: 'day' }">
                <h4 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-trophy mr-2 flex-shrink-0"></i> 
                    BẢNG XẾP HẠNG
                </h4>
                <div class="flex justify-around mb-4">
                    <button class="tab-button" :class="{ 'active': activeTab === 'day' }" @click="activeTab = 'day'">Ngày</button>
                    <button class="tab-button" :class="{ 'active': activeTab === 'week' }" @click="activeTab = 'week'">Tuần</button>
                    <button class="tab-button" :class="{ 'active': activeTab === 'total' }" @click="activeTab = 'total'">ALL</button>
                </div>
                <!-- Tab Ngày -->
                <div x-show="activeTab === 'day'" x-transition.opacity class="space-y-3">
                    <?php foreach ($mostViewedDaily as $index => $truyen): ?>
                        <div class="flex items-center bg-gray-700 p-2 rounded-lg hover:bg-gray-600 transition-colors duration-300 overflow-hidden">
                            <span class="text-yellow-400 font-bold mr-2 text-sm w-6 flex-shrink-0"><?= $index + 1 ?></span>
                            <img src="https://img.otruyenapi.com/uploads/comics/<?= htmlspecialchars($truyen['thumb_url']) ?>" 
                                class="w-10 h-14 object-cover rounded mr-2 flex-shrink-0" 
                                alt="<?= htmlspecialchars($truyen['name']) ?>" 
                                loading="lazy">
                            <div class="flex-1 min-w-0">
                                <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" 
                                class="text-sm font-medium text-white hover:text-yellow-400 transition-colors duration-200 truncate block" 
                                title="<?= htmlspecialchars($truyen['name']) ?>">
                                    <?= htmlspecialchars($truyen['name']) ?>
                                </a>
                                <p class="text-xs text-gray-400 truncate"><i class="fas fa-eye mr-1"></i> <?= formatViews($truyen['daily_views']) ?></p>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
                <!-- Tab Tuần -->
                <div x-show="activeTab === 'week'" x-transition.opacity class="space-y-3">
                    <?php foreach ($mostViewedWeekly as $index => $truyen): ?>
                        <div class="flex items-center bg-gray-700 p-2 rounded-lg hover:bg-gray-600 transition-colors duration-300 overflow-hidden">
                            <span class="text-yellow-400 font-bold mr-2 text-sm w-6 flex-shrink-0"><?= $index + 1 ?></span>
                            <img src="https://img.otruyenapi.com/uploads/comics/<?= htmlspecialchars($truyen['thumb_url']) ?>" 
                                class="w-10 h-14 object-cover rounded mr-2 flex-shrink-0" 
                                alt="<?= htmlspecialchars($truyen['name']) ?>" 
                                loading="lazy">
                            <div class="flex-1 min-w-0">
                                <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" 
                                class="text-sm font-medium text-white hover:text-yellow-400 transition-colors duration-200 truncate block" 
                                title="<?= htmlspecialchars($truyen['name']) ?>">
                                    <?= htmlspecialchars($truyen['name']) ?>
                                </a>
                                <p class="text-xs text-gray-400 truncate"><i class="fas fa-eye mr-1"></i> <?= formatViews($truyen['weekly_views'] ?? $truyen['views']) ?></p>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
                <!-- Tab Tổng -->
                <div x-show="activeTab === 'total'" x-transition.opacity class="space-y-3">
                    <?php foreach ($mostViewedTotal as $index => $truyen): ?>
                        <div class="flex items-center bg-gray-700 p-2 rounded-lg hover:bg-gray-600 transition-colors duration-300 overflow-hidden">
                            <span class="text-yellow-400 font-bold mr-2 text-sm w-6 flex-shrink-0"><?= $index + 1 ?></span>
                            <img src="https://img.otruyenapi.com/uploads/comics/<?= htmlspecialchars($truyen['thumb_url']) ?>" 
                                class="w-10 h-14 object-cover rounded mr-2 flex-shrink-0" 
                                alt="<?= htmlspecialchars($truyen['name']) ?>" 
                                loading="lazy">
                            <div class="flex-1 min-w-0">
                                <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" 
                                class="text-sm font-medium text-white hover:text-yellow-400 transition-colors duration-200 truncate block" 
                                title="<?= htmlspecialchars($truyen['name']) ?>">
                                    <?= htmlspecialchars($truyen['name']) ?>
                                </a>
                                <p class="text-xs text-gray-400 truncate"><i class="fas fa-eye mr-1"></i> <?= formatViews($truyen['views']) ?></p>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
            </div>

            <!-- Truyện Xem Gần Đây -->
            <div class="bg-gray-800 p-4 rounded-lg mb-6">
                <a href="views/lich-su-doc.php" class="block">
                    <h4 class="text-lg font-semibold mb-4 hover:text-green-500 transition-colors duration-300 flex items-center">
                        <i class="fas fa-history mr-2 flex-shrink-0"></i>
                        TRUYỆN XEM GẦN ĐÂY
                    </h4>
                </a>
                <div id="recentlyViewedStories" class="space-y-3">
                    <p class="text-center text-gray-400 text-sm">Bạn chưa xem truyện nào gần đây.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">

        <!-- Manga Slide -->
        <h4 class="text-2xl font-semibold mb-6 text-center">MANGA</h4>
        <div class="horizontal-slider flex gap-3 mb-8">
            <?php if (empty($mangaList)): ?>
                <div class="text-center w-full text-gray-400">Không có truyện Manga nào để hiển thị.</div>
            <?php else: ?>
                <?php foreach ($mangaList as $truyen): ?>
                    <div class="slide-item bg-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 w-40">
                        <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="relative block">
                            <img src="https://img.otruyenapi.com/uploads/comics/<?= htmlspecialchars($truyen['thumb_url']) ?>" 
                                 class="w-full object-cover" 
                                 alt="<?= htmlspecialchars($truyen['name']) ?>" 
                                 loading="lazy" 
                                 style="aspect-ratio: 3/4; height: 220px;">
                            <?php 
                            foreach ($truyen['category'] ?? [] as $cat) {
                                if (in_array($cat['name'], ['Adult', '16+', 'Ecchi', 'Smut'])) {
                                    echo '<span class="badge-18plus">18+</span>';
                                    break;
                                }
                            }
                            ?>
                            <span class="time-tag"><?= timeAgo($truyen['updatedAt'] ?? null) ?></span>
                        </a>
                        <div class="p-2">
                            <h5 class="text-sm font-semibold truncate text-white mb-1 text-center">
                                <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="hover:text-green-500"><?= htmlspecialchars($truyen['name']) ?></a>
                            </h5>
                            <div class="flex justify-between items-center text-xs text-gray-300 mb-1">
                                <span><i class="fas fa-bookmark mr-1 text-green-500"></i> <?= htmlspecialchars($truyen['chaptersLatest'][0]['chapter_name'] ?? 'Chưa có') ?></span>
                                <span><i class="fas fa-eye mr-1 text-yellow-400"></i> <?= formatViews($truyen['views']) ?></span>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
                <div class="slide-item bg-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 w-40 flex items-center justify-center">
                    <a href="views/truyen-theo-the-loai/manga" class="flex flex-col items-center justify-center h-full text-center p-4">
                        <i class="fas fa-arrow-right text-3xl text-green-500 mb-2"></i>
                        <span class="text-sm font-semibold text-white">Xem thêm</span>
                    </a>
                </div>
            <?php endif; ?>
        </div>

        <!-- Manhwa Slide -->
        <h4 class="text-2xl font-semibold mb-6 text-center">MANHWA</h4>
        <div class="horizontal-slider flex gap-3 mb-8">
            <?php if (empty($manhwaList)): ?>
                <div class="text-center w-full text-gray-400">Không có truyện Manhwa nào để hiển thị.</div>
            <?php else: ?>
                <?php foreach ($manhwaList as $truyen): ?>
                    <div class="slide-item bg-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 w-40">
                        <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="relative block">
                            <img src="https://img.otruyenapi.com/uploads/comics/<?= htmlspecialchars($truyen['thumb_url']) ?>" 
                                 class="w-full object-cover" 
                                 alt="<?= htmlspecialchars($truyen['name']) ?>" 
                                 loading="lazy" 
                                 style="aspect-ratio: 3/4; height: 220px;">
                            <?php 
                            foreach ($truyen['category'] ?? [] as $cat) {
                                if (in_array($cat['name'], ['Adult', '16+', 'Ecchi', 'Smut'])) {
                                    echo '<span class="badge-18plus">18+</span>';
                                    break;
                                }
                            }
                            ?>
                            <span class="time-tag"><?= timeAgo($truyen['updatedAt'] ?? null) ?></span>
                        </a>
                        <div class="p-2">
                            <h5 class="text-sm font-semibold truncate text-white mb-1 text-center">
                                <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="hover:text-green-500"><?= htmlspecialchars($truyen['name']) ?></a>
                            </h5>
                            <div class="flex justify-between items-center text-xs text-gray-300 mb-1">
                                <span><i class="fas fa-bookmark mr-1 text-green-500"></i> <?= htmlspecialchars($truyen['chaptersLatest'][0]['chapter_name'] ?? 'Chưa có') ?></span>
                                <span><i class="fas fa-eye mr-1 text-yellow-400"></i> <?= formatViews($truyen['views']) ?></span>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
                <div class="slide-item bg-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 w-40 flex items-center justify-center">
                    <a href="views/truyen-theo-the-loai/manhwa" class="flex flex-col items-center justify-center h-full text-center p-4">
                        <i class="fas fa-arrow-right text-3xl text-green-500 mb-2"></i>
                        <span class="text-sm font-semibold text-white">Xem thêm</span>
                    </a>
                </div>
            <?php endif; ?>
        </div>

        <!-- Manhua Slide -->
        <h4 class="text-2xl font-semibold mb-6 text-center">MANHUA</h4>
        <div class="horizontal-slider flex gap-3 mb-8">
            <?php if (empty($manhuaList)): ?>
                <div class="text-center w-full text-gray-400">Không có truyện Manhua nào để hiển thị.</div>
            <?php else: ?>
                <?php foreach ($manhuaList as $truyen): ?>
                    <div class="slide-item bg-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 w-40">
                        <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="relative block">
                            <img src="https://img.otruyenapi.com/uploads/comics/<?= htmlspecialchars($truyen['thumb_url']) ?>" 
                                 class="w-full object-cover" 
                                 alt="<?= htmlspecialchars($truyen['name']) ?>" 
                                 loading="lazy" 
                                 style="aspect-ratio: 3/4; height: 220px;">
                            <?php 
                            foreach ($truyen['category'] ?? [] as $cat) {
                                if (in_array($cat['name'], ['Adult', '16+', 'Ecchi', 'Smut'])) {
                                    echo '<span class="badge-18plus">18+</span>';
                                    break;
                                }
                            }
                            ?>
                            <span class="time-tag"><?= timeAgo($truyen['updatedAt'] ?? null) ?></span>
                        </a>
                        <div class="p-2">
                            <h5 class="text-sm font-semibold truncate text-white mb-1 text-center">
                                <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="hover:text-green-500"><?= htmlspecialchars($truyen['name']) ?></a>
                            </h5>
                            <div class="flex justify-between items-center text-xs text-gray-300 mb-1">
                                <span><i class="fas fa-bookmark mr-1 text-green-500"></i> <?= htmlspecialchars($truyen['chaptersLatest'][0]['chapter_name'] ?? 'Chưa có') ?></span>
                                <span><i class="fas fa-eye mr-1 text-yellow-400"></i> <?= formatViews($truyen['views']) ?></span>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
                <div class="slide-item bg-gray-700 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 w-40 flex items-center justify-center">
                    <a href="views/truyen-theo-the-loai/manhua" class="flex flex-col items-center justify-center h-full text-center p-4">
                        <i class="fas fa-arrow-right text-3xl text-green-500 mb-2"></i>
                        <span class="text-sm font-semibold text-white">Xem thêm</span>
                    </a>
                </div>
            <?php endif; ?>
        </div>

        <!-- Upcoming Stories Slide -->
        <div class="container mx-auto px-4 py-8">
            <h4 class="text-2xl font-semibold mb-6 text-center flex items-center justify-center">
                <i class="fas fa-clock mr-2"></i> TRUYỆN SẮP RA MẮT
            </h4>
            <div class="relative overflow-hidden">
                <div id="upcomingSlider" class="flex transition-transform duration-300 ease-in-out" style="will-change: transform;">
                    <?php foreach ($upcomingTruyen as $truyen): ?>
                        <div class="flex-shrink-0 w-40 mx-2">
                            <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" class="block">
                                <img src="https://img.otruyenapi.com/uploads/comics/<?= htmlspecialchars($truyen['thumb_url']) ?>" 
                                    alt="<?= htmlspecialchars($truyen['name']) ?>" 
                                    class="w-full h-48 object-cover rounded-lg shadow-md hover:opacity-90 transition" 
                                    loading="lazy">
                            </a>
                            <div class="mt-2 text-center">
                                <a href="views/truyen-tranh/<?= urlencode($truyen['slug']) ?>" 
                                class="text-sm font-medium text-white hover:text-blue-400 transition-colors duration-200 block truncate" 
                                title="<?= htmlspecialchars($truyen['name']) ?>">
                                    <?= htmlspecialchars($truyen['name']) ?>
                                </a>
                                <span><i class="fas fa-bookmark mr-1 text-green-500"></i> <?= htmlspecialchars($truyen['chaptersLatest'][0]['chapter_name'] ?? 'Chưa có') ?></span>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
                <!-- Nút điều khiển trái/phải -->
                <button id="prevSlide" 
                        class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-gray-800 p-2 rounded-full hover:bg-gray-700 transition-colors duration-300 opacity-75 hover:opacity-100">
                    <i class="fas fa-chevron-left text-white"></i>
                </button>
                <button id="nextSlide" 
                        class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-gray-800 p-2 rounded-full hover:bg-gray-700 transition-colors duration-300 opacity-75 hover:opacity-100">
                    <i class="fas fa-chevron-right text-white"></i>
                </button>
            </div>
        </div>
    </div>

    <?php include 'includes/footer.php'; ?>
    
    <script>
    function renderRecentlyViewed() {
        const recentlyViewedContainer = document.getElementById('recentlyViewedStories');
        let readHistory = JSON.parse(localStorage.getItem('readHistory')) || [];
        
        recentlyViewedContainer.innerHTML = ''; // Xóa nội dung cũ

        if (readHistory.length === 0) {
            recentlyViewedContainer.innerHTML = '<p class="text-center text-gray-400 text-sm">Bạn chưa xem truyện nào gần đây.</p>';
            return;
        }

        readHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        const recentStories = readHistory.slice(0, 7);

        recentStories.forEach((chapter, index) => {
            const storyItem = `
                <div class="flex items-center bg-gray-700 p-2 rounded-lg hover:bg-gray-600 transition-colors duration-300 overflow-hidden">
                    <span class="text-green-500 font-bold mr-2 text-sm w-6 flex-shrink-0">${index + 1}</span>
                    <img src="${chapter.chapter_image}" 
                         class="w-10 h-14 object-cover rounded mr-2 flex-shrink-0" 
                         alt="${chapter.chapter_story_name}" 
                         loading="lazy">
                    <div class="flex-1 min-w-0">
                        <a href="views/truyen-tranh/${chapter.chapter_link.split('/')[2]}" 
                           class="text-sm font-medium text-white hover:text-green-500 transition-colors duration-200 truncate block" 
                           title="${chapter.chapter_story_name}">
                            ${chapter.chapter_story_name}
                        </a>
                        <p class="text-xs text-gray-400 truncate"><i class="fas fa-bookmark mr-1"></i>${chapter.chapter_name}</p>
                    </div>
                </div>
            `;
            recentlyViewedContainer.insertAdjacentHTML('beforeend', storyItem);
        });
    }

    document.addEventListener('DOMContentLoaded', renderRecentlyViewed);

    document.addEventListener('DOMContentLoaded', () => {
        const slider = document.getElementById('upcomingSlider');
        const prevButton = document.getElementById('prevSlide');
        const nextButton = document.getElementById('nextSlide');
        const items = slider.children;
        const itemWidth = items[0].offsetWidth + 16; // 16 là tổng margin左右 (mx-2)
        const totalItems = items.length;
        let currentIndex = 0;
        let autoSlide;

        slider.innerHTML += slider.innerHTML;

        function updateSlide() {
            slider.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
        }

        function nextSlide() {
            currentIndex++;
            if (currentIndex >= totalItems) {
                currentIndex = 0;
                slider.style.transition = 'none'; 
                updateSlide();
                requestAnimationFrame(() => {
                    slider.style.transition = 'transform 0.3s ease-in-out';
                });
            }
            updateSlide();
        }

        function prevSlide() {
            currentIndex--;
            if (currentIndex < 0) {
                currentIndex = totalItems - 1;
                slider.style.transition = 'none'; 
                updateSlide();
                requestAnimationFrame(() => {
                    slider.style.transition = 'transform 0.3s ease-in-out';
                });
            }
            updateSlide();
        }

        function startAutoSlide() {
            autoSlide = setInterval(nextSlide, 2000);
        }

        function stopAutoSlide() {
            clearInterval(autoSlide);
        }
        startAutoSlide();

        nextButton.addEventListener('click', () => {
            stopAutoSlide();
            nextSlide();
            startAutoSlide(); 
        });

        prevButton.addEventListener('click', () => {
            stopAutoSlide();
            prevSlide();
            startAutoSlide(); 
        });
        slider.parentElement.addEventListener('mouseenter', stopAutoSlide);
        slider.parentElement.addEventListener('mouseleave', startAutoSlide);
    });
    </script>
</body>
</html>
